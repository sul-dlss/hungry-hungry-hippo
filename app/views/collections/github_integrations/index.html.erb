<% content_for :breadcrumbs do %>
  <%= render Elements::BreadcrumbNavComponent.new do |component| %>
    <% component.with_breadcrumb(text: 'Dashboard', link: dashboard_path) %>
    <% component.with_breadcrumb(text: @collection.title, link: collection_path(@collection)) %>
    <% component.with_breadcrumb(text: 'Manage Github Connection', active: true) %>
  <% end %>
<% end %>

<h1><%= @collection.title %></h1>

<p>Toggle repositories on to automatically deposit in SDR with each GitHub release.</p>

<div class="mb-5">
  <% if @repos.any? %>
    <table class="table">
      <thead>
        <tr>
          <th>Repository</th>
          <th>Linked</th>
          <th>Work / DOI</th>
        </tr>
      </thead>
      <tbody>
        <% @repos.each do |repo| %>
          <tr>
            <td><%= repo[:name] %></td>
            <td>
              <div class="form-check form-switch">
                <%= check_box_tag "repo_toggle_#{repo[:id]}",
                                  '1',
                                  repo[:linked],
                                  class: 'form-check-input',
                                  data: {
                                    controller: 'repo-toggle',
                                    action: 'change->repo-toggle#toggle',
                                    repo_toggle_repo_name_value: repo[:name],
                                    repo_toggle_repo_id_value: repo[:id],
                                    repo_toggle_github_repo_id_value: repo[:github_repo_id],
                                    repo_toggle_collection_druid_value: @collection.druid,
                                    repo_toggle_link_url_value: collection_github_integrations_path(@collection.druid),
                                    repo_toggle_unlink_url_value: repo[:github_repo_id] ? collection_github_integration_path(collection_druid: @collection.druid, id: repo[:github_repo_id]) : ''
                                  } %>
              </div>
            </td>
            <td>
              <% if repo[:linked] && (work = @linked_repos[repo[:name]]&.work) %>
                <%= link_to work.title, work_path(work) %><br>
                <small class="text-muted"><%= Doi.url(druid: work.druid) %></small>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="text-muted">No public repositories found in your GitHub account.</p>
  <% end %>
</div>

<div class="mb-3">
  <%= link_to 'Back to Collection', collection_path(@collection), class: 'btn btn-primary text-white' %>
</div>
