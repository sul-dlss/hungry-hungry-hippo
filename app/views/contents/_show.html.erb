<%= turbo_frame_tag content, 'show' do %>
  <%= turbo_stream_from 'show', content %>
  <% content_files ||= content.content_files.path_order.page(1) %>
  <% if total_files > Kaminari.config.default_per_page # show search bar with section header %>
      <div class="row">
        <div class="col-3">
          <%= render Edit::SectionHeaderComponent.new(title: t('works.edit.panes.files.list')) %>
        </div>
        <div class="col-5 ms-auto">
          <%# Not using TextFieldComponent because field-container conflicts with input-group. %>
          <%= form_with url: content_path(content), method: :get do |form| %>
            <div class="input-group">
              <%= render Elements::Forms::LabelComponent.new(form:, field_name: :q, default_label_class: 'input-group-text', classes: 'bg-white border-end-0') do %>
                <%= search_icon %><span class="visually-hidden">Search files</span>
              <% end %>
              <%= form.text_field :q, class: 'form-control border-start-0', value: search_term, placeholder: 'Search ...' %>
              <div class="input-group-text bg-white" style="padding: 0.3rem;">
                <%= render Elements::Forms::SubmitComponent.new(label: 'Search', classes: 'btn-sm py-1') %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <% if content_files.empty? %>
        <p>There are no results matching "<%= search_term %>".</p>
      <% end %>
    <% else # just show section header %>
      <%= render Edit::SectionHeaderComponent.new(title: t('works.edit.panes.files.list')) %>
    <% end %>

  <% if total_files.zero? %>
    <p>Your files will appear here once they have been uploaded.</p>
  <% else %>
      <% if total_files > Settings.file_upload.hierarchical_files_limit %>
        <%= render Elements::Tables::TableComponent.new(id: 'content-table', label: 'Files', show_label: false) do |component| %>
          <%# These headers are duplicated in app/components/works/edit/content_hierarchy_component.html.erb %>
          <% component.with_headers([
                                      { label: 'File Name' },
                                      { label: 'Description', tooltip: t('content_files.edit.fields.description.tooltip_html'), style: 'width: 180px;' },
                                      { label: 'Hide', tooltip: t('content_files.edit.fields.hide.tooltip_html'), style: 'width: 85px;' },
                                      { label: 'Action', style: 'width: 85px;' }
                                    ]) %>
          <% content_files.each do |content_file| %>
            <% component.with_row do |row_component| %>
              <% row_component.with_cell do %>
                <%= content_file.filepath %>
              <% end %>
              <% row_component.with_cell do %>
                <%= render Works::Edit::ContentFileDescriptionComponent.new(content_file:) %>
              <% end %>
              <% row_component.with_cell do %>
                <%= render Works::Edit::ContentFileHideComponent.new(content_file:) %>
              <% end %>
              <% row_component.with_cell do %>
                <%= render Works::Edit::ContentFileDeleteComponent.new(content_file:) %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <%= paginate content_files, params: { controller: 'contents', action: 'show', id: content.id } %>
      <% else %>
        <%= render Works::Edit::ContentHierarchyComponent.new(content_files:) %>
        <%= paginate content_files, params: { controller: 'contents', action: 'show', id: content.id } %>
      <% end %>
  <% end %>
<% end %>
